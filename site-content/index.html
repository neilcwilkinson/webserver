<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>Sample of websocket with golang</title>
		<script src="jquery-1.8.3.min.js"></script>    

    <script type="application/javascript">
    var myip = 'unknown'
     $(document).ready(function() {
      $.getJSON("https://api.ipify.org?format=jsonp&callback=?",
        function(json) {
          myip = json.ip;
          $("#ip-addr").text(myip);

          var string = "ws://" + myip + ":8080/rates"

          var ws = new WebSocket("ws://" + myip + ":8080/rates");
          ws.onopen = function(e) {
          $("#latest-rate").text("Welcome");
        };
        ws.onclose = function(e) {
          $("#latest-rate").text("Dangit");
        };
        ws.onmessage = function(e) {
          rateCount += 1;
          $("#latest-rate").text(event.data);
          $("#rate-count").text(rateCount);
        };

        var $ul = $('#msg-list');
        $('#sendBtn').click(function(){
          var data = $('#name').val();
          ws.send(data);
          console.log("送信メッセージ:" + data);
          $('<li>').text(data).appendTo($ul);
        });
        }
      );
    });

      $(function() {

      });

      var rateCount = 0;
		</script>

    <script type="application/javascript">
 
</script>

	</head>
	<body>
			<!-- <input id="name" type="text" />
			<input type="button" id="sendBtn" value="send"></input>
      <ul id="msg-list"></ul> -->
      <p id="ip-addr">Unknown</p>
      <p id="rate-count">None</p>
      <p id="latest-rate">None</p>
	</body>
</html>
